<div class="main">
  <div class="row main">
    <div class="col-2 side-bar">
      <h3 class="pane-title">Executions</h3>
      <i class="fa fa-spinner fa-spin fa-3x fa-fw" *ngIf="loading"></i>
      <div *ngIf="!results && !loading">
        We didn't find any execution
      </div>
      <div class="list-group">
        <button type="button" class="list-group-item list-group-item-action" (click)="onSelectResult()">Map logs</button>
        <button type="button" class="list-group-item list-group-item-action"
                [ngClass]="{'active': result._id === selectedResult?._id }"
                *ngFor="let result of results; let i = index" (click)="onSelectResult(result)">{{ i + 1 }}
          ({{result.startTime | date: 'short'}})
        </button>
      </div>
    </div>
    <div class="col-10 main-result">
      <h3 class="pane-title">Results</h3>
      <div class="result" *ngIf="!selectedResult">
        <table class="table">
          <thead>
          <tr>
            <th scope="col">Time</th>
            <th scope="col">Type</th>
            <th scope="col">Message</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let log of executionLogs; let i = index;" class="animated flash">
            <td>{{ log.createdAt | date: 'medium' }}</td>
            <td>{{ log.status }}</td>
            <td>{{ log.message }}</td>
          </tr>
          </tbody>
        </table>
      </div>
      <div class="result" *ngIf="selectedResult">
        <div class="card-deck ">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Run id</h4>
              <h6 class="card-subtitle mb-2 text-muted">{{selectedResult.runId}}</h6>

            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Structure id</h4>
              <h6 class="card-subtitle mb-2 text-muted">{{selectedResult.structure}}</h6>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Start Time</h4>
              <h6 class="card-subtitle mb-2 text-muted">{{selectedResult.startTime}}</h6>

            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Finish Time</h4>
              <h6 class="card-subtitle mb-2 text-muted">{{selectedResult.finishTime}}</h6>
            </div>
          </div>
        </div> <!-- / card-deck -->
        <hr>
        <div class="card-deck">
          <!-- agent graph -->
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Agent statuses</h4>
              <ngx-charts-pie-chart
                [view]="[200,200]"
                [scheme]="colorScheme"
                [results]="agentAggregatedStatus"
                [doughnut]="true"
                [gradient]="gradient"
                *ngIf="agentAggregatedStatus"
              >
              </ngx-charts-pie-chart>
            </div>
          </div>

          <!-- logs card-->
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Run logs</h4>
              <table class="table">
                <thead>
                <tr>
                  <th scope="col">Time</th>
                  <th scope="col">Type</th>
                  <th scope="col">Message</th>
                </tr>
                </thead>
                <tbody>
                <tr
                  *ngFor="let log of executionLogs | filter:{term: selectedResult.runId, param: 'runId'}; let i = index;">
                  <td>{{ log.createdAt | date: 'medium' }}</td>
                  <td>{{ log.status }}</td>
                  <td>{{ log.message }}</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <hr>

        <!-- processes -->
        <div class="row result-cards" *ngIf="processChunks">
          <div class="caret-left">
            <i class="fa fa-caret-square-o-left fa-2x" aria-hidden="true" (click)="previousProcessChunk()"></i>
          </div>
          <div class="caret-right">
            <i class="fa fa-caret-square-o-right fa-2x" aria-hidden="true" (click)="nextProcessChunk()"></i>
          </div>
          <div class="col-4" *ngFor="let process of processChunks[processChunksIndex]">
            <app-process-result [process]="process" (click)="onSelectProcess(process)"></app-process-result>
          </div>
          <div class="col-12 text-center">
            <i class="index-selector fa"
               [ngClass]="{'fa-dot-circle-o': processChunksIndex === i, 'fa-circle-o': processChunksIndex !== i}"
               aria-hidden="true" *ngFor="let chunk of processChunks; let i = index"
               (click)="processChunksIndex = i"></i>
          </div>
        </div>

        <hr>

        <!-- actions -->
        <div class="row result-cards" *ngIf="selectedProcess">
          <div class="caret-left">
            <i class="fa fa-caret-square-o-left fa-2x" aria-hidden="true" (click)="previousActionChunk()"></i>
          </div>
          <div class="caret-right">
            <i class="fa fa-caret-square-o-right fa-2x" aria-hidden="true" (click)="nextActionChunk()"></i>
          </div>
          <div class="col-4" *ngFor="let action of actionChunks[actionChunksIndex]">
            <app-action-result [action]="action"></app-action-result>
          </div>
          <div class="col-12 text-center">
            <i class="index-selector fa"
               [ngClass]="{'fa-dot-circle-o': actionChunksIndex === i, 'fa-circle-o': actionChunksIndex !== i}"
               aria-hidden="true" *ngFor="let chunk of actionChunks; let i = index"
               (click)="processChunksIndex = i"></i>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>
